# github.com/go-task/task

version: '2'

vars:
  # List of packages to be installed.
  rpm_absent: |
     amarok banshee gbrainy awscli unison240-gtk
     python2-pytest python2-fabric python2-invoke
  # Lists of packages to be removed.
  base_distro: |
    python-paramiko python-yaml python-jinja2 python-simplejson python-pip
    yum-cron python3-firewall createrepo snapd
  devopstools: |
    vim-X11 vim-enhanced automake gcc gcc-c++ rpm-build subversion
    # development tools
    mercurial git hub git-svn gitk sqlite arduino jq ShellCheck
    direnv stow
    # vim / syntastic
    nodejs-js-yaml rubygem-puppet-lint yamllint
    # Python development.
    python-devel python-crypto python-virtualenv python-virtualenvwrapper
    python-mock 
    python3-ipython python3-black python3-pytest python3-flake8 python3-jedi
    python-psutil pydot httpie python-py python-docopt
    python-click python-pip python-sh python2-pika
    python3-requests python3-pika
    # Ruby development.
    ruby ruby-devel rubygems rubygem-bundler rubygem-rake rubygem-wirb 
    rubygem-pry rubygem-pry-doc rubygem-rspec rubygem-rspec-mocks 
    rubygem-rspec-mocks-doc
    # Golang devel.
    golang
    # Nagios plugins development.
    pynag pynag-examples
    #
    # Ops
    python3-fabric
    # -- requires repo_docker
    docker-ce 
    par pssh pdsh pdsh-mod-dshgroup
    mysql percona-toolkit gnuplot httpd-tools
    #rubygem-rails      # puppet storedconfigs requirement
    puppet rubygem-puppet-lint rubygem-puppet-lint-doc pass
    #
    # libvirt-bin service must not be run: installs and launches dnsmasq configures virt0 interface.
    #libvirt-bin
    virt-manager
    # dependencies for building aws-google-auth
    libusb-devel systemd-devel
  unix_essentials: |
    ack fzf htop dstat tree rsync wget curl screen units vim pv lsof strace colordiff
    the_silver_searcher fd-find ncdu bat
  workstation: |
    kernel-headers kernel-devel dkms
    # Xwindows
    kernel-modules-extra joystick-support wmctrl xdotool qgnomeplatform
    xorg-x11-xkb-extras xorg-x11-xkb-utils xkbset xcape
    # Command-line.
    aspell aspell-ca aspell-en aspell-es
    hunspell hunspell-ca hunspell-en-US hunspell-es-ES
    mythes mythes-ca mythes-en mythes-es
    hyphen hyphen-ca hyphen-en hyphen-es
    autocorr-ca autocorr-en autocorr-es
    pandoc unison240-text moreutils xclip tmux lastpass-cli
    inotify-tools tiptop ranger w3m w3m-img vpnc timew imapfilter
    java-1.8.0-openjdk icedtea-web 
    # GUI apps.
    pidgin pidgin-libnotify pidgin-guifications
    python2-pygpgme keepassx
    freemind calibre inkscape firefox
    libreoffice timeline youtube-dl Zim
    levien-inconsolata-fonts
    zathura speedcrunch homebank flameshot
    # Graphics
    gimp ufraw-gimp gimp-wavelet-denoise-plugin gimp-separate+
    gimp-paint-studio gimp-normalmap gimp-help GREYCstoration-gimp
    gimp-resynthesizer gimp-lqr-plugin gimp-high-pass-filter gimp-elsamuko
    gimp-data-extras
    digikam kf5-kipi-plugins darktable
    # Multimedia
    clementine audacity pavucontrol ffmpeg cantata
    qjackctl jack-audio-connection-kit alsa-plugins-jack sooperlooper
    vlc                # require: RPMfusion repositories
    # joystick
    antimicro linuxconsoletools
    # from local.repo
    #aws-shell sublime-text rubygem-watson
    # 
    # skype
    # sigil                 #needs repo ppa:ikuya-fruitsbasket
  codecs: |
    # require: rpmfusion-free
    xine-lib-extras xine-lib-extras-freeworld k3b-extras-freeworld gstreamer1-libav
    gstreamer1-plugins-good gstreamer1-plugins-ugly gstreamer1-plugins-bad-free
    gstreamer-ffmpeg gstreamer-plugins-good gstreamer-plugins-ugly
    gstreamer-plugins-bad gstreamer-plugins-bad-free ffmpeg
    # require: rpmfusion-non-free
    gstreamer-plugins-bad-nonfree
  nvidia_hardware: |
    #alternative: - kmod-nvidia-PAE 
    #alternative: - xorg-x11-drv-nouveau
    akmod-nvidia-304xx xorg-x11-drv-nvidia-304xx xorg-x11-drv-nvidia-cuda
    kernel-devel
    # hardware video acceleration
    vdpauinfo libva-vdpau-driver libva-utils
  kde: |
    xdg-desktop-portal-kde plasma-browser-integration
  awesomewm: |
    awesome awesome-doc vicious scrot network-manager-applet
    light xautolock i3lock
    feh lximage-qt arandr lxappearance lxqt-powermanagement screengrab
    # plank compton
  lxqt: |
    @lxqt
  vagrant: |
    vagrant vagrant-doc vagrant-lxc vagrant-lxc-doc vagrant-libvirt
    vagrant-libvirt-doc vagrant-cachier vagrant-cachier-doc
    vagrant-hostmanager vagrant-hostmanager-doc
    lxc                 # vagrant-lxc requirement
    lxc-doc             # vagrant-lxc requirement
    redir               # vagrant-lxc requirement
    VirtualBox kmod-VirtualBox



tasks:

  ################################################## 
  # Helpers to install/remove packages.

  dnf:
    cmds:
      - sudo dnf install -y {{ regexReplaceAll "#.*" .pkgs "" | catLines }}
  dnf_remove:
    cmds:
      - sudo dnf remove {{ regexReplaceAll "#.*" .pkgs "" | catLines }} || true





  ################################################## 
  #
  
  repo_rpmfusion:
    # Installs RPMfusion repos.
    cmds:
      - sudo dnf install -y https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{.release}}.noarch.rpm
        https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{.release}}.noarch.rpm
    vars:
      release:
        sh: rpm -E %fedora
    status:
      - rpm -q rpmfusion-free-release-{{.release}}
      - rpm -q rpmfusion-nonfree-release-{{.release}}

  repo_fedora_thirdparty:
    # Install Fedora Third Party repos.
    cmds:
      - sudo dnf install -y fedora-workstation-repositories
    status:
      - rpm -q fedora-workstation-repositories

  repo_percona:
    cmds:
      - sudo dnf install http://www.percona.com/downloads/percona-release/redhat/0.1-6/percona-release-0.1-6.noarch.rpm
      - sudo sed -i 's/$releasever/6/g' /etc/yum.repos.d/percona-release.repo
    status:
      - rpm -q percona-release

  repo_docker:
    cmds:
      - sudo dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo
    status:
      - test -f /etc/yum.repos.d/docker-ce.repo

  repos:
    # Install all repositories.
    deps: [ repo_rpmfusion, repo_fedora_thirdparty, repo_percona, repo_docker ]




  ################################################## 
  #
  
  pkg:
    desc: Install all the packages to configure a Fedora workstation.
    deps: [repos]
    cmds:
      - task: dnf_remove
        vars: { pkgs: "{{.rpm_absent}}" }
      - task: dnf
        vars: { pkgs: "{{.devopstools}} {{.base_distro}} {{.unix_essentials}} {{.workstation}} {{.codecs}} {{.kde}} {{.awesomewm}} {{.lxqt}} {{.vagrant}}" }
      - task: spotify
      - task: chrome
      - task: dropbox
      - task: keybase

  nvidia:
    #desc: Install modules and utils for Nvidia.
    deps: [repos]
    cmds:
      - task: dnf
        vars: { pkgs: "{{.nvidia_hardware}}" }

  spotify:
    #desc: Install spotify client.
    deps: [repos]
    cmds:
      - sudo snap install spotify
    status:
      - snap list spotify

  chrome:
    #desc: Install google chrome.
    deps: [repos]
    cmds:
      - sudo dnf config-manager --set-enabled google-chrome
      - sudo dnf install google-chrome-stable
    status:
      - rpm -q google-chrome-stable

  keybase:
    #desc: Install keybase.io client
    deps: [repos]
    cmds:
      - sudo dnf install -y https://prerelease.keybase.io/keybase_amd64.rpm
    status:
      - rpm -q keybase

  dropbox:
    #desc: Install Dropbox client.
    deps: [repos]
    cmds:
      - sudo dnf install -y dropbox
      # [todo] - run 'dropbox start -i'
    status:
      - rpm -q dropbox






  ################################################## 
  #

  non-pkg:
    desc: Install not-packaged software.
    deps:
      - awless
      - caddy
      - diff-so-fancy
      - fasd
      - fonts-powerline
      - fonts-hack
      - fpm
      - fx
      - gh
      - gotask
      - gron
      # - helm
      - hugo
      - jiq
      # - kops
      # - kubectl
      # - minikube
      - packer
      - peco
      - pet
      - pup
      - powerline-go
      - sheet
      - telegram
      # - terraform
      - vim_vundle

  awless:
    #desc: Install awless.
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}}
      - tar -xzf awless*tar.gz
      - sudo install awless /usr/local/bin/
    status:
      - which awless
    vars:
      VERSION: 0.1.11
      URL: https://github.com/wallix/awless/releases/download/v{{.VERSION}}/awless-linux-amd64.tar.gz

  caddy:
    #desc: Install caddy
    dir: /tmp
    cmds:
      - curl -s -o caddy.tgz '{{.URL}}'
      - tar -xzf caddy.tgz caddy
      - sudo install --mode 0755 caddy /usr/local/bin
    status:
      - which caddy
    vars:
      URL: https://caddyserver.com/download/linux/amd64?license=personal&telemetry=off


  diff-so-fancy:
    #desc: Install diff-so-fancy.
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}}
      - sudo install diff-so-fancy /usr/local/bin/
    status:
      - which diff-so-fancy
    vars:
      URL: https://raw.githubusercontent.com/so-fancy/diff-so-fancy/master/third_party/build_fatpack/diff-so-fancy


  docker-machine-driver-kvm2:
    #desc: Install docker-machine-driver-kvm2.
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}} -O /tmp/docker-machine-driver-kvm2
      - sudo install -m 755 docker-machine-driver-kvm2 /usr/local/bin/
    status:
      - test -f /usr/local/bin/docker-machine-driver-kvm2
    vars:
      URL: https://storage.googleapis.com/minikube/releases/latest/docker-machine-driver-kvm2

  fasd:
    dir: /tmp
    cmds:
      - curl -sO https://raw.githubusercontent.com/clvv/fasd/master/fasd
      - sudo install -m 755 fasd /usr/local/bin
    status:
      - test -f /usr/local/bin/fasd 


  fonts-powerline:
    #desc: Install fonts for Powerline on user's home.
    cmds:
      - cd ~/.fonts ; git clone https://github.com/Lokaltog/powerline-fonts
      - fc-cache -vf ~/.fonts
    status:
      - test -d ~/.fonts/powerline-fonts


  fonts-hack:
    #desc: Install font Hack from https://github.com/ryanoasis/nerd-fonts
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}}
      - test -d ~/.fonts/Hack && rm -r ~/.fonts/Hack || true
      - mkdir -p ~/.local/share/fonts/Hack
      - unzip -d ~/.local/share/fonts/Hack Hack.zip
      - fc-cache -fv
    status:
      - test -d ~/.local/share/fonts/Hack
    vars:
      URL: https://github.com/ryanoasis/nerd-fonts/releases/download/v2.1.0/Hack.zip


  fpm:
    #desc: Install 'fpm' at ~/.gem/
    cmds:
      - sudo dnf install -y rubygem-ffi rubygem-childprocess rubygem-backports ruby-devel rpm-build
      - gem install --user-install fpm
    status:
      - which fpm > /dev/null
      # Fetching: cabin-0.6.1.gem (100%)
      # Fetching: backports-3.6.0.gem (100%)
      # Fetching: arr-pm-0.0.9.gem (100%)
      # Fetching: clamp-0.6.3.gem (100%)
      # Fetching: ffi-1.9.3.gem (100%)

  fx:
    #desc: Install fx
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}}
      - unzip /tmp/fx-linux.zip
      - sudo install fx-linux /usr/local/bin/fx
    status:
      - test -f /usr/local/bin/fx
    vars:
      VERSION: 14.0.1
      URL: https://github.com/antonmedv/fx/releases/download/{{.VERSION}}/fx-linux.zip


  gh:
    #desc: Install Github CLI.
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}}
      - sudo dnf -y localinstall gh_{{.VERSION}}_linux_amd64.rpm
    status:
      - test -f /usr/local/bin/gh
    vars:
      VERSION: 0.5.4
      URL: https://github.com/cli/cli/releases/download/v{{.VERSION}}/gh_{{.VERSION}}_linux_amd64.rpm 


  gotask:
    desc: install go-task
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}}
      - tar -xzf task_linux_amd64.tar.gz
      - sudo install task /usr/local/bin/
    status:
      - which task
    vars:
      VERSION: 2.6.0
      URL: https://github.com/go-task/task/releases/download/v{{.VERSION}}/task_linux_amd64.tar.gz


  gron:
    #desc: Install gron
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}} -O gron.tgz
      - tar -xzf /tmp/gron.tgz
      - sudo install gron /usr/local/bin/
    status:
      - test -f /usr/local/bin/gron
    vars:
      VERSION: 0.6.0
      URL: https://github.com/tomnomnom/gron/releases/download/v{{.VERSION}}/gron-linux-amd64-{{.VERSION}}.tgz

  helm:
    #desc: Install helm. https://helm.sh
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}} -O helm.tar.gz
      - tar -xzf /tmp/helm.tar.gz
      - sudo install linux-amd64/helm /usr/local/bin/
    status:
      - test -f /usr/local/bin/helm
    vars:
      VERSION: 2.8.2
      URL: https://storage.googleapis.com/kubernetes-helm/helm-v{{.VERSION}}-linux-amd64.tar.gz


  hugo:
    #desc: Install hugo. https://github.com/gohugoio/hugo/
    dir: /usr/local/bin
    cmds:
      - cd /tmp ; wget -nv -c {{.URL}} -O hugo.tar.gz
      - sudo tar -xzf /tmp/hugo.tar.gz hugo
    status:
      - test -f /usr/local/bin/hugo
    vars:
      VERSION: 0.26
      URL: https://github.com/gohugoio/hugo/releases/download/v{{.VERSION}}/hugo_{{.VERSION}}_Linux-64bit.tar.gz


  jiq:
    #desc: Install jiq. https://github.com/fiatjaf/jiq
    dir: /usr/local/bin
    cmds:
      - go get github.com/fiatjaf/jiq/cmd/jiq
      - sudo cp ~/code/go/bin/jiq /usr/local/bin
    status:
      - test -f /usr/local/bin/jiq


  kops:
    #desc: Install kops. https://github.com/kubernetes/kops
    dir: /tmp
    cmds:
      - wget -nv {{.URL}}
      - sudo install kops-linux-amd64 /usr/local/bin/kops
      - kops completion bash > kops.completion
      - sudo install -m 644 kops.completion /etc/bash_completion.d/kops
    status:
      - which kops > /dev/null
    vars:
      VERSION: 1.8.1
      URL: https://github.com/kubernetes/kops/releases/download/{{.VERSION}}/kops-linux-amd64


  kubectl:
    #desc: Install kubectl
    cmds:
      - gcloud components install kubectl
    status:
      - which kubectl > /dev/null
  #
  # kubernetes:
  #   #desc: Install kubectl (stable release).
  #   dir: /tmp
  #   cmds:
  #     - wget -nv -c {{.URL}}
  #     - sudo install kubectl /usr/local/bin
  #     - kubectl completion bash > k8s.completion
  #     - sudo install -m 644 k8s.completion /etc/bash_completion.d/kubernetes
  #   vars:
  #     VERSION:
  #       sh: curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt
  #     URL: https://storage.googleapis.com/kubernetes-release/release/{{.VERSION}}/bin/linux/amd64/kubectl


  minikube:
    #desc: Install minikube.
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}} -O /tmp/minikube
      - sudo install minikube /usr/local/bin/
      - minikube completion bash > minikube.completion
      - sudo install -m 644 minikube.completion /etc/bash_completion.d/minikube
    status:
      - test -f /usr/local/bin/minikube
    vars:
      VERSION: 0.25.0
      URL: https://storage.googleapis.com/minikube/releases/v{{.VERSION}}/minikube-linux-amd64


  peco:
    #desc: "Install peco. https://github.com/peco/peco"
    dir: /tmp
    cmds:
      - wget -nv -c "{{.URL}}" -O {{.NAME}}.tar.gz
      - tar -xzf {{.NAME}}.tar.gz
      - sudo install -m 0755 peco_linux_amd64/{{.NAME}} /usr/local/bin
    status:
      - test -f /usr/local/bin/{{.NAME}}
    vars:
      NAME: peco
      VERSION: 0.5.3
      URL: "https://github.com/peco/peco/releases/download/v{{.VERSION}}/peco_linux_amd64.tar.gz"


  pet:
    #desc: "Install pet. https://github.com/knqyf263/pet"
    dir: /tmp
    cmds:
      - wget -nv -c "{{.URL}}" -O pet.tar.gz
      - tar -xzf pet.tar.gz
      - sudo install -m 0755 pet /usr/local/bin
    status:
      - test -f /usr/local/bin/pet
    vars:
      VERSION: 0.3.2
      URL: "https://github.com/knqyf263/pet/releases/download/v{{.VERSION}}/pet_{{.VERSION}}_linux_amd64.tar.gz"


  pup:
    #desc: Install pup
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}} -O pup.zip
      - unzip /tmp/pup.zip
      - sudo install pup /usr/local/bin/
    status:
      - test -f /usr/local/bin/pup
    vars:
      VERSION: 0.4.0
      URL: https://github.com/ericchiang/pup/releases/download/v{{.VERSION}}/pup_v{{.VERSION}}_linux_amd64.zip


  powerline-go:
    #desc: Install powerline-go. https://github.com/justjanne/powerline-go
    dir: /tmp
    cmds:
      - wget -nv -c {{.URL}} -O {{.NAME}}
      - sudo install -m 0755 {{.NAME}} /usr/local/bin
    status:
      - test -f /usr/local/bin/{{.NAME}}
    vars:
      NAME: powerline-go
      VERSION: 1.11.0
      URL: https://github.com/justjanne/powerline-go/releases/download/v{{.VERSION}}/powerline-go-linux-amd64


  sheet:
    #desc: Install 'sheet' at ~/.gem/
    cmds:
      # - sudo dnf install -y rubygem-ffi rubygem-childprocess rubygem-backports ruby-devel rpm-build
      - gem install --user-install sheet
    status:
      - which sheet > /dev/null


  telegram:
    #desc: Install Telegram Linux client.
    dir: /usr/local/bin
    cmds:
      - wget -nv -c {{.URL}} -O /tmp/tsetup.tar.xz
      - sudo tar -C /srv -xJf /tmp/tsetup.tar.xz
      - sudo chown -R root:root /srv/Telegram
      - sudo ln -s /srv/Telegram/Telegram .
    status:
      - test -f /srv/Telegram/Telegram
    vars:
      URL: https://telegram.org/dl/desktop/linux


  terraform:
    #desc: Install terraform. https://www.terraform.io
    dir: /usr/local/bin
    cmds:
      - wget -nv -c {{.URL}} -O /tmp/terraform.zip
      - sudo unzip /tmp/terraform.zip
    status:
      - test -f /usr/local/bin/terraform
    vars:
      VERSION: 0.10.0
      URL: https://releases.hashicorp.com/terraform/{{.VERSION}}/terraform_{{.VERSION}}_linux_amd64.zip


  packer:
    #desc: Install packer. https://www.packer.io/
    dir: /usr/local/bin
    cmds:
      - wget -nv -c {{.URL}} -O /tmp/packer.zip
      - sudo unzip /tmp/packer.zip
    status:
      - test -f /usr/local/bin/packer
    vars:
      VERSION: 1.4.4
      URL: https://releases.hashicorp.com/packer/{{.VERSION}}/packer_{{.VERSION}}_linux_amd64.zip


  vim_vundle:
    #desc: Clone Vim Vundle to your ~/.vim/.
    cmds:
      - git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
    status:
      - test -d ~/.vim/bundle/Vundle.vim


  kubeval:
    #desc: Install kubeval. https://github.com/garethr/kubeval
    dir: /usr/local/bin
    cmds:
      - wget -nv -c {{.URL}} -O /tmp/{{.NAME}}.tar.gz
      - sudo tar -xzf /tmp/{{.NAME}}.tar.gz
    status:
      - test -f /usr/local/bin/{{.NAME}}
    vars:
      NAME: kubeval
      VERSION: 0.7.0
      URL: https://github.com/garethr/{{.NAME}}/releases/download/{{.VERSION}}/{{.NAME}}-linux-amd64.tar.gz


  kubetest:
    #desc: Install kubetest. https://github.com/garethr/kubetest
    dir: /usr/local/bin
    cmds:
      - wget -nv -c {{.URL}} -O /tmp/{{.NAME}}.tar.gz
      - sudo tar -xzf /tmp/{{.NAME}}.tar.gz
    status:
      - test -f /usr/local/bin/{{.NAME}}
    vars:
      NAME: kubetest
      VERSION: 0.1.1
      URL: https://github.com/garethr/{{.NAME}}/releases/download/{{.VERSION}}/{{.NAME}}-linux-amd64.tar.gz






  ################################################## 
  #
  pipx:
    desc: "Use pipx to install python packages on venvs"
    cmds:
      - task: pipx-binary
      - task: pipx-packages
      - task: awscli

  pipx-binary:
    cmds:
      - pip3 install --user pipx
    status:
      - which pipx

  pipx-packages:
    deps:
      # - task: pipx-install
      #   vars:
      #     pkg: "aws-google-auth"
      #     args: "--spec 'aws-google-auth[u2f]'"
      #   # build dependencies: libusb-devel systemd-devel
      - { task: pipx-install, vars: { pkg: "cfn-lint" } }
      - { task: pipx-install, vars: { pkg: "pew" } }
      - { task: pipx-install, vars: { pkg: "pex" } }
      - { task: pipx-install, vars: { pkg: "pipenv" } }
      - { task: pipx-install, vars: { pkg: "pipenv-pipes" } }
      # - { task: pipx-install, vars: { pkg: "aws-sam-cli" } }

  pipx-install:
    # Helper to install packages using pipx
    cmds: 
      - pipx install {{ .pkg }} {{ .args|default "" }}
    status:
      - pipx list | grep -q {{ .pkg }}

  awscli:
    cmds:
      - pipx install awscli
      - pipx inject awscli ec2instanceconnectcli
      - ln -sf ~/.local/pipx/venvs/awscli/bin/mssh ~/.local/bin
    status:
      - pipx list | grep -q awscli



  ################################################## 
  #

  config:
    desc: Post-install config tasks.
    cmds:
        # Set folder to store Virtualbox machines
      - VBoxManage setproperty machinefolder /home/jordif/spool/VirtualBox_VMs
      - sudo usermod -aG docker $(whoami)

  config-firefox:
    desc: Minor Firefox tweaks.
    cmds:
      - test -f ~/.gtkrc-2.0 || touch ~/.gtkrc-2.0
      - sed -i 's/# *gtk-key-theme-name =/gtk-key-theme-name =/' ~/.gtkrc-2.0
      - grep -q 'gtk-key-theme-name =' ~/.gtkrc-2.0 
        || echo 'gtk-key-theme-name = "Emacs"' >> ~/.gtkrc-2.0
        # Firefox uses kde file manager: requires xdg-desktop-portal-kde
        # Set the app launcher command to: GTK_USE_PORTAL=1 firefox %u

  config-kde:
    desc: KDE tweaks.
    cmds:
        # https://userbase.kde.org/Plasma/Tips
        # 'Meta' opens krunner
      # - kwriteconfig5 --file ~/.config/kwinrc --group ModifierOnlyShortcuts --key Meta "org.kde.kglobalaccel,/component/krunner,org.kde.kglobalaccel.Component,invokeShortcut,run command"
      # - qdbus org.kde.KWin /KWin reconfigure
        #
        # 'Meta' does nothing by itself
      - kwriteconfig5 --file ~/.config/kwinrc --group ModifierOnlyShortcuts --key Meta ""
      - qdbus org.kde.KWin /KWin reconfigure
